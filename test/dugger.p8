pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
--main

function _init()
	td=0
	ta=0
	dg={st=0,sp=1,x=64,y=64,xm=false}
	dias=0
end


function _update60()
	if dg.st==0 then
		if btnp(➡️) then
			dg.st=1
		end
		if btnp(⬅️) then
			dg.st=3
		end
		if btnp(⬆️) then
			dg.st=4
		end
		if btnp(⬇️) then
			dg.st=2
		end
	end
	ta+=1
	dug()
end

function _draw()
	cls()
	map()
 print("diamonds: "..dias.."  d.st: "..dg.st.." td: "..td,1,2)

	phys()
--	amsen()
	spr(dg.sp,dg.x,dg.y,1,1,dg.xm,dg.ym)

end




-->8
-- game func

function dug()
	if dg.st == 1 then
		dg.st=10
		dg.sp=1
		dg.xm=false
		dg.ym=false
		if fget(mget(dg.x\8+1,dg.y\8),2) then
			sfx(3)
			dias+=1
		end
	end
	if dg.st == 3 then
		dg.st=10
		dg.sp=1
		dg.xm=true
		dg.ym=false
		if fget(mget(dg.x\8-1,dg.y\8),2) then
			sfx(3)
			dias+=1
		end
	end
	if dg.st == 2 then
		dg.st=11
		dg.sp=3
		dg.xm=false
		dg.ym=true
	end
	if dg.st == 4 then
		dg.st=11
		dg.sp=3
		dg.ym=false
		dg.ym=false
	end

	if dg.st==10 then
		if td%3==0 then
			sfx(0)
		end
		if dg.xm then
			dg.x=dg.x-1
		else
			dg.x=dg.x+1
		end
		td+=1
		dg.sp=1+td%2
		if td>7 then
			td=0
			dg.st=0
			mset(dg.x\8,dg.y\8,24)
		end	
	end

	if dg.st==11 then
		if td%3==0 then
			sfx(0)
		end
		if dg.ym then
			dg.y=dg.y+1
		else
			dg.y=dg.y-1
		end
		td+=1
		dg.sp=3+td%2
		if td>7 then
			td=0
			dg.st=0
			mset(dg.x\8,dg.y\8,24)
		end	
	end
end

function init_ams()

end

function phys()
local mx
local my
local sp
	if ta%8!=0 then return end

	for mx=0,16 do
		for my=16,0,-1 do
			sp=mget(mx,my)
			if fget(sp,3) then
				if fget(mget(mx,my+1),0) then
-- 				print(fget(sp,3),2,80)
 				mset(mx,my,24)
 				if fget(sp,4) then
	 				mset(mx,my+1,sp+1)
					else
	 				mset(mx,my+1,sp)
					end	 			

-- 				return
				end
			end
		end
	end
end


function amsen()

end
-->8
-- todo

-- state machine?
	-- steht vor stein
	-- lauft li/re/ho/ru
	-- sammelt dia
	
-- 

-- doku

-- flag 0 tunnel
-- flag 1 buddelbar
-- flag 2 collect
-- flag 3 phys
-- flag 4 free

__gfx__
0000000000aa000000aa000007700000000770000000000000000000000000004444454445444444444444440000000044444454000000000000000000000000
0000000000aaa07700aaa0000750000000075000000000000000000000000000454444444444444444444aa400000aa0454cc444000cc0000000000000000000
00700700004f0057004f000000f00000000cf0000000000000000000000000004444444444444445444aa7a4000aa7a0447ccc44007ccc000000000000000000
0007700000f00f0000f0000000caa0f000caacf000000000000000000000000044454444454544444aaa77940aaa77904ccc77c40ccc77c00000000000000000
0007700000ccc00000cccf6700caac0000caa00000000000000000000000000044444454444444544aaa99940aaa99904ccc71140ccc71100000000000000000
0070070000cc000000cc0077000cc400000cc00000000000000000000000000044454444444444444aa994440aa9900044cc114400cc11000000000000000000
0000000000c0c0000c0c0000000c0c00004cc00000000000000000000000000045444444454445444a9444440a90000044411444000110000000000000000000
00000000040040000400400000400000000004000000000000000000000000004444444544444444444444440000000044444445000000000000000000000000
a000000a0000000000077000000000000000000000aa000000aa0000000000000004000000000000444554440005500044444454000000000000000000000000
000000000007550000075000000000000000000000aaa07700aaa00000000000000000000000000544dd6d4400dd6d00444bb444000bb0000000000000000000
0000000000766610000cf0000000000000000000004f0057004f000000000000000000000000005445d5d55405d5d550447bbb44007bbb000000000000000000
000000000766166100caacf0000000000000000000f00f0000f000000000000000000000000000454d611dd60d611dd64bbb77b40bbb77b00000000000000000
000000000761116100caa000000000000000000000ccc00000cccf6700000000000000000000041456175d5556175d554bbb73340bbb73300000000000000000
0000000007661661000cc000000000000000000000cc000000cc0077000000000000000000000554dd5171d4dd5171d044bb334400bb33000000000000000000
0000000007661661004cc000000000000000000000c0c0000c0c0000000000000000000000004041451d1174051d117054433454000330000000000000000000
a000000a0766666100000400000000000000000004004000040040000000000004000400000455554451d5440051d50044444444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000004000400000000000707007000700707000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000400000000060606000606060000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000004000000000000008e8e8b008e8e8b000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000040000000000e8e8e8e8e8e8e8e800000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000040000000000000e8e8e8e8e8e8e8e800000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000400000000008e8e8b008e8e8b000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000060606000606060000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000004004004000000000070070707070070000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000ee007700ee00000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000768888600688886700000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000eeee0770eeee0000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000068888600688886000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000070eeee0000eeee0700000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000068888677688886000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000070beeb0000beeb0700000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000880000008800000000000000000000000000000000000
__gff__
0101010101000000020204041c0c00000000000000000000010018081c0c0000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0809090909090908080a0808080c0c0808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080909090c0c0908080808080c0c0c0808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08081a090c180808080c08080c0c0c0808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080809091818090a080c0c080c0c0c0808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08091c1c0909080808081a081818080808080a08081a080808080808080a0808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808091c091818180818181818181a0808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808081c0a180918081808091818180808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
081a080808181818181808091818180808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080809080808081808091808180808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808081818181808111a0808081a081a080808080808080808080808080808080b0808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08080808080808080808080808080808080808081a0808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08081a08080808080a08080808080808081a1a1a1a1a1a080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808081a0808080808080808080808080b0808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08080808080808080808080808080808081a1a1a1a1a1a080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080a08080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08080a0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08080a080808080808080808080808080a080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08080808080808080808080808080808080808080808080808080a0808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080b08080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000200001764000600016000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000012430224501a4501742000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000300002d51032510005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500
0004000036150351203c1503b13000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0020000018b5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
