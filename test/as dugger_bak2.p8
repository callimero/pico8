pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
	dg={x,y,dx,dy,s}
	dg.x = 8
	dg.y = 8
	dg.s = 0
	dg.dx=0
	dg.dy=0
	init_ams()
	dig={8,9,24}
	fal={10,11,26}
end


function _update60()
-- if fget(mget(dg.x/8+dg.dx,dg.y/8+dg.dy))<3 then	

	if btnp(➡️) and dg.s==0 then
		dg.s = 8	
		dg.dx = 1	
		dg.dy = 0	
	end
	if btnp(⬅️) and dg.s==0 then
		dg.s = 8	
		dg.dx = -1	
		dg.dy = 0	
	end
	if btnp(⬆️) and dg.s==0 then
		dg.s = 8	
		dg.dy = -1	
		dg.dx = 0	
	end
	if btnp(⬇️) and dg.s==0 then
		dg.s = 8	
		dg.dy = 1
		dg.dx = 0		
	end
--end
	if dg.s>0 then
		if dg.s%4==0 then
			sfx(0)
		end

		dg.x=dg.x+dg.dx
		dg.y=dg.y+dg.dy
		dg.s-=1
		if dg.s<=0 then	
			dg.s=0
			mset(dg.x/8,dg.y/8,24)	
		end
	end
end

function _draw()
	local so=0
	cls()
	map()
	print(mget(dg.x/8+dg.dx,dg.y/8+dg.dy),2,2)
--	print(dg.dx.." "..dg.dy,1,2)
--	spr(25,dg.x,dg.y,1,1,dg.dx==-1,dg.dy==1)
	amsen()
 if dg.dy!=0 then so=2 end
	spr(dg.s/2%2+1+so,dg.x,dg.y,1,1,dg.dx==-1,dg.dy==1)

end




-->8
-- state machine?
	-- steht vor stein
	-- lauft li/re/ho/ru
	-- sammelt dia
	
-- 
function init_ams()
	ams={}
	add(ams,{d=3,x=9*8*2,y=5*8*2})
	add(ams,{d=2,x=9*8*2,y=6*8*2})
	dmx={1,0,-1,0}
	dmy={0,1,0,-1}
end

function amsen()
	local i=0
	for a in all(ams) do
--  							print(a.x\16+dmx[a.d].." "..a.y\16+dmy[a.d],a.x\2+8,a.y\2+8)
		if fget(mget(a.x\16+dmx[a.d],a.y\16+dmy[a.d]),1) then
--			print(a.d)
			a.d=a.d+1
			if a.d>4 then a.d=1 end
		else
			a.x+=dmx[a.d]
			a.y+=dmy[a.d]
--			print(a.d)
			print(dmx[a.d].." "..dmy[a.d])
		end
		print("a.d "..a.d,a.x\2+8,a.y\2+8)
--		print(a.d)

		spr(42,a.x\2,a.y\2)
--		spr(16,a.x\2+dmx[a.d],a.y\2+dmy[a.d])

	end

end
__gfx__
0000000000aa000000aa000007700000000770000000000000000000000000004444454445444444444444440000000044444444000000000000000000000000
0000000000aaa07700aaa0000750000000075000000000000000000000000000454444444444444444444aa400000aa0444cc444000cc0000000000000000000
00700700004f0057004f000000f00000000cf0000000000000000000000000004444444444444445444aa7a4000aa7a0447ccc44007ccc000000000000000000
0007700000f00f0000f0000000caa0f000caacf000000000000000000000000044454444454544444aaa77940aaa77904ccc77c40ccc77c00000000000000000
0007700000ccc00000cccf6700caac0000caa00000000000000000000000000044444454444444544aaa99940aaa99904ccc71140ccc71100000000000000000
0070070000cc000000cc0077000cc400000cc00000000000000000000000000044454444444444444aa994440aa9900044cc114400cc11000000000000000000
0000000000c0c0000c0c0000000c0c00004cc00000000000000000000000000045444444454445444a9444440a90000044411444000110000000000000000000
00000000040040000400400000400000000004000000000000000000000000004444444544444444444444440000000044444444000000000000000000000000
a000000a0770000000077000000000000000000000aa000000aa0000000000000004000000000000444554440005500044444444000000000000000000000000
000000000750000000075000000000000000000000aaa07700aaa00000000000000000000000000544dd6d4400dd6d00444bb444000bb0000000000000000000
0000000000f00000000cf0000000000000000000004f0057004f000000000000000000000000005445d5d55405d5d550447bbb44007bbb000000000000000000
0000000000caa0f000caacf0000000000000000000f00f0000f000000000000000000000000000454d611dd60d611dd64bbb77b40bbb77b00000000000000000
0000000000caac0000caa000000000000000000000ccc00000cccf6700000000000000000000041456175d5556175d554bbb73340bbb73300000000000000000
00000000000cc400000cc000000000000000000000cc000000cc0077000000000000000000000554dd5171d4dd5171d044bb334400bb33000000000000000000
00000000000c0c00004cc000000000000000000000c0c0000c0c0000000000000000000000004041451d1174051d117044433444000330000000000000000000
a000000a0040000000000400000000000000000004004000040040000000000004000400000455554451d5440051d50044444444000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000004000400000000000707007000700707000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000400000000060606000606060000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000004000000000000008e8e8b008e8e8b000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000040000000000e8e8e8e8e8e8e8e800000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000040000000000000e8e8e8e8e8e8e8e800000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000400000000008e8e8b008e8e8b000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000060606000606060000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000004004004000000000070070707070070000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000ee007700ee00000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000768888600688886700000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000eeee0770eeee0000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000068888600688886000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000070eeee0000eeee0700000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000068888677688886000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000070beeb0000beeb0700000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000880000008800000000000000000000000000000000000
__gff__
0000000000000000020206060606000000000000000000000100060606060000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0809090909090908080a08080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080909090c0c0908080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08081a090c080808080c08080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080809090908090a080c0c080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08091c1c0909080808081a080808080808080a08081a080808080808080a0808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808091c090818181818181818081a0808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808081c0a080918081808091808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
081a080808090918181808091808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080809080808081808091808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808081818181808081a0808081a081a080808080808080808080808080808080b0808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08080808080808080808080808080808080808081a0808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08081a08080808080a08080808080808081a1a1a1a1a1a080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
080808081a0808080808080808080808080b0808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08080808080808080808080808080808081a1a1a1a1a1a080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080a08080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08080a0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08080a080808080808080808080808080a080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08080808080808080808080808080808080808080808080808080a0808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080b08080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000200001764000600016000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0004000012430224501a4501742000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
