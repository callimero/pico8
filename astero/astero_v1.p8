pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
	rt=0
	bt=0
	d2=0
	maxb=5
	ast={}
	bul={}
	exp={}
	for i=1,8 do
		add(ast,{x=rnd(100)+14,y=rnd(100)+14,sx=rnd()-0.4,sy=rnd()-0.4})
	end
	ship={x=64,y=64,v=0,vx=0,vy=0,r=0}
	stars={}
	for i=1,50 do
		add(stars,{x=rnd(128),y=rnd(128),c=rnd(3)+5})
	end
end

function _update()
	local dx=0
	local dy=0
	for a in all(ast) do
	 a.x+=a.sx
	 a.y+=a.sy
	 if a.x>=128 then a.x=0 end
	 if a.y>=128 then a.y=0 end
	 if a.x<=-8 then a.x=128 end
	 if a.y<=-8 then a.y=128 end
	end
	for a in all(ast) do
		for b in all(ast) do
			dx=a.x-b.x-4
			dy=a.y-b.y-4
			d2=dx*dx+dy*dy
			if d2<=24 then
--				print(d2)
				a.sx=a.sx*-1
				a.sy=a.sy*-1
				b.sx=b.sx*-1
				b.sy=b.sy*-1				
			end
			--print(d2)
		end
	end
	
	bt-=1
	if btn(❎) and bt<0 and #bul<maxb then
		bt=4
		local xx=cos(ship.r)
		local yy=-sin(ship.r)
		add(bul,{t=60,
											x=ship.x+xx*4,
											y=ship.y+yy*4,
											vx=(xx+ship.vx)*1.5,
											vy=(yy+ship.vy)*1.5})
	end
	
	rt-=1
	if btn(⬅️) and rt<0 then
		ship.r-=0.0625/2.0
		rt=1
	end
	if btn(➡️) and rt<0 then
		ship.r+=0.0625/2.0
		rt=1
	end
 ship.r = ship.r % 1
	if btn(⬆️) then
		ship.vx=ship.vx+cos(ship.r)*.2
		ship.vy=ship.vy-sin(ship.r)*.2
	end
	ship.x=ship.x+ship.vx
	ship.y=ship.y+ship.vy
	if ship.x>124 then ship.x=-4 end
	if ship.x<-4  then ship.x=124 end
	if ship.y>124 then ship.y=-4 end
	if ship.y<-4 then ship.y=124 end
	
	ship.vx=ship.vx*0.98
	ship.vy=ship.vy*0.98

 for b in all(bul) do
 	b.x=b.x+b.vx
 	b.y=b.y+b.vy
 	if b.x>126 then b.x=2 end
 	if b.y>126 then b.y=2 end
 	if b.x<2 then b.x=126 end
 	if b.y<2 then b.y=126 end
 	b.t-=1

		for a in all(ast) do
			for b in all(bul) do
				dx=a.x-b.x-4
				dy=a.y-b.y-4
				d2=dx*dx+dy*dy
				if d2<24 then
					del(ast,a)
					del(bul,b)
					for i=1,4 do
						add(exp,{t=4,x=b.x+rnd(4)-2,y=b.y+rnd(4)+2})
					end	
				end
			end
		end
 	if b.t<=0 then
 		del(bul,b)
 	end
 end	
--	if btn(⬇️) then
--		ship.y+=1
--	end
end

function _draw()
	cls()
	for s in all(stars) do
		pset(s.x,s.y,s.c)
	end
	for b in all(bul) do
		spr(2,b.x,b.y)
	end
	for a in all(ast) do
		spr(1,a.x,a.y)
	end
	for e in all(exp) do
		spr(33,e.x,e.y)
		e.t-=1
		if e.t<=0 then
			del(exp,e)
		end
	end
	local sn=flr((ship.r+0.25)*8)%8
	spr((3+sn),ship.x,ship.y,1,1)
	--print("time :"..(time()),10,10)
end
__gfx__
00000000006660000000000000dbd00000ddd00000ddd00000ddd00000ddd00000ddd00000ddd00000ddd0000000000000000000000000000000000000000000
0000000006656560000000000d0b0d000d000b000d000d000d000d000d000d000d000d000d000d000b000d000000000000000000000000000000000000000000
007007006666666600070000d00b00d0d000b0d0d00000d0d00000d0d00000d0d00000d0d00000d0d0b000d00000000000000000000000000000000000000000
0007700066666656007b7000d00b00d0d00b00d0d00bbbb0d00b00d0d00b00d0d00b00d0bbbb00d0d00b00d00000000000000000000000000000000000000000
000770006566666600070000d00000d0d00000d0d00000d0d000b0d0d00b00d0d0b000d0d00000d0d00000d00000000000000000000000000000000000000000
007007006566ddd0000000000d000d000d000d000d000d000d000b000d0b0d000b000d000d000d000d000d000000000000000000000000000000000000000000
00000000066d5dd00000000000ddd00000ddd00000ddd00000ddd00000dbd00000ddd00000ddd00000ddd0000000000000000000000000000000000000000000
0000000000dddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000008a80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000008a7a8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000008a80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
