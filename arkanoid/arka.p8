pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- game loop
function _init()
 dug=""
 ba={x=24,y=50,sx=1.2,sy=-1.6}
 pa={x=64,y=110,s=2.5,w=2.4}
 ptk={}
 p={x=0,y=0,sx=0,sy=0,c=7}
 scol={{7,13,12,12,12,12,12},
       {7,2,8,8,8,8,8},
       {7,9,10,10,10,10,10}}
 dc={2,3,4,5,13}
 bck={}
 for i=1,10 do
		add_back()
 end
end

function _update60()
	if btn(⬅️) and pa.x>0 then
		pa.x-=pa.s
	end
	if btn(➡️) and pa.x<(128-8*pa.w) then
		pa.x+=pa.s
	end
	if (ba.x+2>pa.x and ba.x<pa.x+8*pa.w) and ba.y>pa.y-3 then
		ba.sy*=-1
		sfx(1)
	end
		
	if fget(mget(ba.x/8,ba.y/8))==1 then
  sfx(0)
		local sn=mget(ba.x/8,ba.y/8)
	 mset(ba.x/8,ba.y/8,0)
	 for x=1,8 do
	 	add(ptk,{x=ba.x+x-4,y=ba.y-rnd(4),sx=rnd(.8)-.4,sy=rnd(2)+1,
	 					c=scol[sn-15][flr(rnd(6)+1)]})
	 end
	 ba.sy*=-1
		
elseif fget(mget(ba.x/8,ba.y/8))==2 then
  sfx(0)
		local sn=mget(ba.x/8,ba.y/8)
	 mset(ba.x/8,ba.y/8,17)
	 for x=1,8 do
	 	add(ptk,{x=ba.x+x-4,y=ba.y-rnd(4),sx=rnd(.8)-.4,sy=rnd(2)+1,
	 					c=scol[sn-15][flr(rnd(6)+1)]})
	 end
	 ba.sy*=-1
	end	
	ba.x+=ba.sx
	ba.y+=ba.sy
	if ba.x>124 or ba.x<0 then ba.sx*=-1 end
	if ba.y>124 or ba.y<0 then ba.sy*=-1 end
 for p in all(ptk) do
 	p.y+=p.sy
 	p.x+=p.sx
 	if p.y>128 then
 		del(ptk,p)
 	end
 end	
end

function _draw()
	cls(1)
	for r in all(bck) do
	 r.y1+=r.s
	 r.y2+=r.s
	 if r.y1>128 then
	  del(bck,r)	
	  add_back()  
	 end
		rectfill(r.x1,r.y1,r.x2,r.y2,r.c)
	end
	map()
--	print(dug,4,2,4)
	spr(5,ba.x+3,ba.y+3)
	sspr(32,0,8,8,pa.x,pa.y,8*pa.w,8)
	for p in all(ptk) do
		pset(p.x,p.y,p.c)
	end
	spr(3,ba.x,ba.y)
end

-->8
-- functions
function add_back()
	local yy=rnd(64)-64
 add(bck,{x1=rnd(64),
 									y1=yy,
 									x2=rnd(64)+64,
 									y2=yy+rnd(32),
 									c=dc[flr(rnd(#dc)+1)],
 									s=rnd(1)+.1})
end
__gfx__
000000000000000000888800066000000eeeeee00110000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000800008008aaaa8067760000e888888e1111000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700008008008a9999a867760000eeeeeeee1111000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000009a0008a9999a806600000dddddddd0110000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000a90008a9999a800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700008008008a9999a800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000800008008aaaa8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000088880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777777777777777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7ccccccd788888827aaaaaa900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7ccccccd788888827aaaaaa900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7ccccccd788888827aaaaaa900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddddd222222229999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000001000000000000000000000002040200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101111111111111111111010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1012121212121212121212121212121000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000200003055029550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000600002755000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0005000030350303502535025350253501c3501c3101c310133101331013310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
